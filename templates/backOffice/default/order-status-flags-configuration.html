{block name="main-content"}
<div class="orders">
        <div class="row">
            <div class="col-md-12">
                <div class="general-block-decorator">
                    {if ! empty($general_error) }
                        <div class="alert alert-danger">{$general_error}</div>
                    {/if}
                    <div class="table-responsive">
                        <table class="table table-striped table-condensed table-left-aligned">
                            <caption class="clearfix">
                                {intl l='Flags status'}
                                {include file='renderer/buttons.html' btn_group=false buttons=[
                                [
                                'type' => 'create',
                                'class' => 'action-btn',
                                'title' => {intl l='Add a new flag'},
                                'href' => 'order-status-flags#creation_flags_dialog',
                                'auth' => ['resource' => 'admin.order-status'],
                                'data' => [
                                'toggle' => 'modal'
                                ]
                                ]
                                ]}
                            </caption>

                            <thead>
                            <tr>
                                <th class="object-title">
                                    {intl l='ID'}
                                </th>

                                <th class="object-title">
                                    {intl l='Code'}
                                </th>

                                <th class="object-title">
                                    {intl l='Flag'}
                                </th>

                                <th class="object-title">
                                    {intl l='Orders'}
                                </th>

                                <th class="object-title">
                                    {intl l='Orders status'}
                                </th>

                                <th class="object-title">
                                    {intl l='Position'}
                                </th>

                                <th class="actions">{intl l="Actions"}</th>
                            </tr>
                            </thead>

                            <tbody>

                            {loop type="order-status-flags-loop" name="order-status-flags-list" backend_context="1"}

                                <tr>
                                    <td>
                                        <a href="{url path="/admin/configuration/order-status/update-flags/%id" id=$ID}">{$ID}</a>
                                    </td>
                                    <td>
                                        <a href="{url path="/admin/configuration/order-status/update-flags/%id" id=$ID}">{$CODE}</a>
                                    </td>
                                    <td>
                                        <a class="label" style="background-color: {$COLOR};" href="{url path="/admin/configuration/order-status/update-flags/%id" id=$ID}">#{$TITLE}</a>
                                    </td>
                                    <td>
                                        <a href="{url path="/admin/orders" status={', '|implode:$ORDER_STATUS_IDS}}">
                                            {assign var='orderStatusIds' value=','|implode:$ORDER_STATUS_IDS}
                                            {count type="order" name="order" customer="*" backend_context="1" status=$orderStatusIds}
                                        </a>
                                    </td>
                                    <td>
                                        {loop type="order_status" name="order-status" flag_id=$orderStatusIds}
                                            <a class="label" style="background-color: {$COLOR};" href="{url path="/admin/configuration/order-status/update/%id" id=$ID}">{$TITLE}</a>
                                        {/loop}
                                    </td>
                                    <td>
                                        {admin_position_block
                                        resource="flags.update-position"
                                        access="UPDATE"
                                        path={url path='admin/configuration/order-status/update-flags-position' flags_id=$ID}
                                        url_parameter="flags_id"
                                        in_place_edit_class="flagsPositionChange"
                                        position=$POSITION
                                        flags_id=$ID
                                        }
                                    </td>

                                    <td class="actions">
                                            {$buttons = [
                                            [
                                            'type' => 'edit',
                                            'title' => {intl l='Edit this flag'},
                                            'href' => {url path="/admin/configuration/order-status/update-flags/%id" id=$ID},
                                            'auth' => ['resource' => 'admin.order-status']
                                            ]
                                            ]}
                                            {if !$DELETABLE|default:null}
                                                {$buttons[] = [
                                                'type' => 'delete',
                                                'class' => 'order-status-flags-cancel',
                                                'title' => {intl l='Delete this flag'},
                                                'href' => '#cancel_order-status-flags_dialog',
                                                'data' => [
                                                'id' => $ID,
                                                'toggle' => 'modal'
                                                ],
                                                'auth' => ['resource' => 'admin.order-status']
                                                ]}
                                            {/if}
                                            {include file='renderer/buttons.html' buttons=$buttons}
                                    </td>
                                </tr>

                            {/loop}

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {form name="order-status-flags.creation"}

    {* Capture the dialog body, to pass it to the generic dialog *}
    {capture "creation_dialog"}
        {form_hidden_fields exclude="locale"}

        {render_form_field field="success_url" value={url path='/admin/configuration/order-status/update/_ID_'}}

        {custom_render_form_field field="title"}
            {loop type="lang" name="default-lang" default_only="1"}
                {* Switch edition to the current locale *}
                <input type="hidden" name="edit_language_id" value="{$ID}" />

                {render_form_field field="locale" value=$LOCALE}

                <div class="input-group">
                    <input type="text" class="form-control" {form_field_attributes field="title"}>
                    <span class="input-group-addon"><img class="img-flags" src="{image file="assets/img/svgFlags/$CODE.svg"}" alt="{$TITLE}" /></span>
                </div>
            {/loop}
        {/custom_render_form_field}

        <div class="row">
            <div class="col-md-6">
            {custom_render_form_field field="code"}
                <div class="input-group">
                    <input type="text" class="form-control" {form_field_attributes field="code"}>
                </div>
            {/custom_render_form_field}
            </div>
            <div class="col-md-6">
            {custom_render_form_field field="color"}
                <div class="input-group">
                    <input type="color" class="form-control" style="width: 100px;" {form_field_attributes field="color"}>
                </div>
            {/custom_render_form_field}
            </div>
        </div>

        {hook name='brand.create-form' location='brand_create_form'}

    {/capture}

    {include
        file = "includes/generic-create-dialog.html"

        dialog_id    = "creation_flags_dialog"
        dialog_title = {intl l="Create a flag"}
        dialog_body  = {$smarty.capture.creation_dialog nofilter}

        dialog_ok_label     = {intl l="Create this flag"}

        form_action        = {url path="/admin/configuration/order-status/create-flags"}
        form_enctype       = {form_enctype}
        form_error_message = $form_error_message
    }
    {/form}

    {* Cancel order confirmation dialog *}

    {capture "cancel_order_status_flags_dialog"}
        <input type="hidden" name="order_status_flags_id" id="cancel_order-status_flags_id" />
    {/capture}

    {include
    file = "includes/generic-confirm-dialog.html"

    dialog_id       = "cancel_order-status-flags_dialog"
    dialog_title    = {intl l="Delete an order status"}
    dialog_message  = {intl l="Do you really want to delete this flag ?"}

    form_action         = {token_url path='/admin/configuration/order-status-flags/delete'}
    form_content        = {$smarty.capture.cancel_order_status_dialog nofilter}
    form_id             = "cancel-order-status-form"
    }

{/block}
